theme_bw() +
theme(panel.grid = element_blank(),
axis.text.x = element_blank(),
axis.text.y = element_blank(),)
#Plotagem
vendas %>%
ggplot() +
geom_smooth(aes(x = receita, y = hlm_final_fitted, color = "Modelo HLM Final"),
method = "lm", se = F, formula = y ~ splines::bs(x, df = 5),
size = 1.5) +
geom_smooth(aes(x = receita, y= ols_final_fitted, color = "OLS Final"),
method = "lm", se = F, formula = y ~ splines::bs(x, df = 5),
size = 1.5) +
# normal
geom_smooth(aes(x = receita, y = receita), method = "lm",
color = "gray44", size = 1.05,
linetype = "longdash") +
geom_point(aes(x = receita, y = ols_final_fitted,
color = "OLS Final"), size = 0.7) +
geom_point(aes(x = receita, y = hlm_final_fitted,
color = "Modelo HLM Final"), size = 0.7)  +
scale_color_manual("Modelos:",
values = c("deepskyblue2","darkorchid2"))+ #, "darkorchid2", "darkorchid2")) +
labs(x = "Receita real", y = "Fitted Values") +
theme_bw() +
theme(panel.grid = element_blank(),
axis.text.x = element_blank(),
axis.text.y = element_blank(),)
#Plotagem
vendas %>%
ggplot() +
geom_smooth(aes(x = receita, y = hlm_final_fitted, color = "Modelo HLM Final"),
method = "lm", se = F, formula = y ~ splines::bs(x, df = 5),
size = 1.5) +
geom_smooth(aes(x = receita, y= ols_final_fitted, color = "OLS Final"),
method = "lm", se = F, formula = y ~ splines::bs(x, df = 5),
size = 1.5) +
# normal
geom_smooth(aes(x = receita, y = receita), method = "lm",
color = "gray44", size = 1.05,
linetype = "longdash") +
geom_point(aes(x = receita, y = ols_final_fitted,
color = "OLS Final"), size = 0.7) +
geom_point(aes(x = receita, y = hlm_final_fitted,
color = "Modelo HLM Final"), size = 0.7)  +
scale_color_manual("Modelos:",
values = c("deepskyblue2","darkorchid2"))+ #, "darkorchid2", "darkorchid2")) +
labs(x = "Receita real", y = "Fitted Values") +
theme_bw() +
theme(panel.grid = element_blank(),
axis.text.x = element_blank(),
axis.text.y = element_blank(),
legend.text = element_text(family = "Arial", size = 11))
#Plotagem
vendas %>%
ggplot() +
geom_smooth(aes(x = receita, y = hlm_final_fitted, color = "Modelo HLM Final"),
method = "lm", se = F, formula = y ~ splines::bs(x, df = 5),
size = 1.5) +
geom_smooth(aes(x = receita, y= ols_final_fitted, color = "OLS Final"),
method = "lm", se = F, formula = y ~ splines::bs(x, df = 5),
size = 1.5) +
# normal
geom_smooth(aes(x = receita, y = receita), method = "lm",
color = "gray44", size = 1.05,
linetype = "longdash") +
geom_point(aes(x = receita, y = ols_final_fitted,
color = "OLS Final"), size = 0.7) +
geom_point(aes(x = receita, y = hlm_final_fitted,
color = "Modelo HLM Final"), size = 0.7)  +
scale_color_manual("Modelos:",
values = c("deepskyblue2","darkorchid2"))+ #, "darkorchid2", "darkorchid2")) +
labs(x = "Receita real", y = "Fitted Values") +
theme_bw() +
theme(panel.grid = element_blank(),
axis.text.x = element_blank(),
axis.text.y = element_blank(),
axis.title.x = element_text(family = "Arial", size = 2),
legend.text = element_text(family = "Arial", size = 11))
#Plotagem
vendas %>%
ggplot() +
geom_smooth(aes(x = receita, y = hlm_final_fitted, color = "Modelo HLM Final"),
method = "lm", se = F, formula = y ~ splines::bs(x, df = 5),
size = 1.5) +
geom_smooth(aes(x = receita, y= ols_final_fitted, color = "OLS Final"),
method = "lm", se = F, formula = y ~ splines::bs(x, df = 5),
size = 1.5) +
# normal
geom_smooth(aes(x = receita, y = receita), method = "lm",
color = "gray44", size = 1.05,
linetype = "longdash") +
geom_point(aes(x = receita, y = ols_final_fitted,
color = "OLS Final"), size = 0.7) +
geom_point(aes(x = receita, y = hlm_final_fitted,
color = "Modelo HLM Final"), size = 0.7)  +
scale_color_manual("Modelos:",
values = c("deepskyblue2","darkorchid2"))+ #, "darkorchid2", "darkorchid2")) +
labs(x = "Receita real", y = "Fitted Values") +
theme_bw() +
theme(panel.grid = element_blank(),
axis.text.x = element_blank(),
axis.text.y = element_blank(),
axis.title.x = element_text(family = "Arial", size = 11),
legend.text = element_text(family = "Arial", size = 11))
#Plotagem
vendas %>%
ggplot() +
geom_smooth(aes(x = receita, y = hlm_final_fitted, color = "Modelo HLM Final"),
method = "lm", se = F, formula = y ~ splines::bs(x, df = 5),
size = 1.5) +
geom_smooth(aes(x = receita, y= ols_final_fitted, color = "OLS Final"),
method = "lm", se = F, formula = y ~ splines::bs(x, df = 5),
size = 1.5) +
# normal
geom_smooth(aes(x = receita, y = receita), method = "lm",
color = "gray44", size = 1.05,
linetype = "longdash") +
geom_point(aes(x = receita, y = ols_final_fitted,
color = "OLS Final"), size = 0.7) +
geom_point(aes(x = receita, y = hlm_final_fitted,
color = "Modelo HLM Final"), size = 0.7)  +
scale_color_manual("Modelos:",
values = c("deepskyblue2","darkorchid2"))+ #, "darkorchid2", "darkorchid2")) +
labs(x = "Receita real", y = "Fitted Values") +
theme_bw() +
theme(panel.grid = element_blank(),
axis.text.x = element_blank(),
axis.text.y = element_blank(),
axis.title.x = element_text(family = "Arial", size = 11),
axis.title.y = element_text(family = "Arial", size = 11),
legend.text = element_text(family = "Arial", size = 11))
#Plotagem
vendas %>%
ggplot() +
geom_smooth(aes(x = receita, y = hlm_final_fitted, color = "Modelo HLM Final"),
method = "lm", se = F, formula = y ~ splines::bs(x, df = 5),
size = 1.5) +
geom_smooth(aes(x = receita, y= ols_final_fitted, color = "OLS Final"),
method = "lm", se = F, formula = y ~ splines::bs(x, df = 5),
size = 1.5) +
# normal
geom_smooth(aes(x = receita, y = receita), method = "lm",
color = "gray44", size = 1.05,
linetype = "longdash") +
geom_point(aes(x = receita, y = ols_final_fitted,
color = "OLS Final"), size = 0.7) +
geom_point(aes(x = receita, y = hlm_final_fitted,
color = "Modelo HLM Final"), size = 0.7)  +
scale_color_manual("Modelos:",
values = c("deepskyblue2","darkorchid2"))+ #, "darkorchid2", "darkorchid2")) +
labs(x = "Receita real", y = "Fitted Values") +
theme_bw() +
theme(panel.grid = element_blank(),
axis.text.x = element_blank(),
axis.text.y = element_blank(),
axis.title.x = element_text(family = "Arial", size = 11),
axis.title.y = element_text(family = "Arial", size = 11),
legend.text = element_text(family = "Arial", size = 11))
#Plotagem
vendas %>%
ggplot() +
geom_smooth(aes(x = receita, y = hlm_final_fitted, color = "Modelo HLM Final"),
method = "lm", se = F, formula = y ~ splines::bs(x, df = 5),
size = 1.5) +
geom_smooth(aes(x = receita, y= ols_final_fitted, color = "OLS Final"),
method = "lm", se = F, formula = y ~ splines::bs(x, df = 5),
size = 1.5) +
# normal
geom_smooth(aes(x = receita, y = receita), method = "lm",
color = "gray44", size = 1.05,
linetype = "longdash") +
geom_point(aes(x = receita, y = ols_final_fitted,
color = "OLS Final"), size = 0.7) +
geom_point(aes(x = receita, y = hlm_final_fitted,
color = "Modelo HLM Final"), size = 0.7)  +
scale_color_manual("Modelos:",
values = c("deepskyblue2","darkorchid2"))+ #, "darkorchid2", "darkorchid2")) +
labs(x = "Receita real", y = "Fitted Values") +
theme_bw() +
theme(panel.grid = element_blank(),
axis.text.x = element_blank(),
axis.text.y = element_blank(),
axis.title.x = element_text(family = "Arial", size = 11),
axis.title.y = element_text(family = "Arial", size = 11),
legend.text = element_text(family = "Arial", size = 11))
#Plotagem
vendas %>%
ggplot() +
geom_smooth(aes(x = receita, y = hlm_final_fitted, color = "Modelo HLM Final"),
method = "lm", se = F, formula = y ~ splines::bs(x, df = 5),
size = 1.5) +
geom_smooth(aes(x = receita, y= ols_final_fitted, color = "OLS Final"),
method = "lm", se = F, formula = y ~ splines::bs(x, df = 5),
size = 1.5) +
# normal
geom_smooth(aes(x = receita, y = receita), method = "lm",
color = "gray44", size = 1.05,
linetype = "longdash") +
geom_point(aes(x = receita, y = ols_final_fitted,
color = "OLS Final"), size = 0.7) +
geom_point(aes(x = receita, y = hlm_final_fitted,
color = "Modelo HLM Final"), size = 0.7)  +
scale_color_manual("Modelos:",
values = c("deepskyblue2","darkorchid2"))+ #, "darkorchid2", "darkorchid2")) +
labs(x = "Receita real", y = "Fitted Values") +
theme_bw() +
theme(panel.grid = element_blank(),
axis.text.x = element_blank(),
axis.text.y = element_blank(),
#axis.title.x = element_text(family = "Arial", size = 11),
#axis.title.y = element_text(family = "Arial", size = 11),
legend.text = element_text(family = "Arial", size = 11))
?element_text
#Plotagem
vendas %>%
ggplot() +
geom_smooth(aes(x = receita, y = hlm_final_fitted, color = "Modelo HLM Final"),
method = "lm", se = F, formula = y ~ splines::bs(x, df = 5),
size = 1.5) +
geom_smooth(aes(x = receita, y= ols_final_fitted, color = "OLS Final"),
method = "lm", se = F, formula = y ~ splines::bs(x, df = 5),
size = 1.5) +
# normal
geom_smooth(aes(x = receita, y = receita), method = "lm",
color = "gray44", size = 1.05,
linetype = "longdash") +
geom_point(aes(x = receita, y = ols_final_fitted,
color = "OLS Final"), size = 0.7) +
geom_point(aes(x = receita, y = hlm_final_fitted,
color = "Modelo HLM Final"), size = 0.7)  +
scale_color_manual("Modelos:",
values = c("deepskyblue2","darkorchid2"))+ #, "darkorchid2", "darkorchid2")) +
labs(x = "Receita real", y = "Fitted Values") +
theme_bw() +
theme(panel.grid = element_blank(),
axis.text.x = element_blank(),
axis.text.y = element_blank(),
axis.title.x = element_text(size = 11),
axis.title.y = element_text(size = 11),
legend.text = element_text(size = 11))
#Plotagem
plotly(
vendas %>%
ggplot() +
geom_smooth(aes(x = receita, y = hlm_final_fitted, color = "Modelo HLM Final"),
method = "lm", se = F, formula = y ~ splines::bs(x, df = 5),
size = 1.5) +
geom_smooth(aes(x = receita, y= ols_final_fitted, color = "OLS Final"),
method = "lm", se = F, formula = y ~ splines::bs(x, df = 5),
size = 1.5) +
# normal
geom_smooth(aes(x = receita, y = receita), method = "lm",
color = "gray44", size = 1.05,
linetype = "longdash") +
geom_point(aes(x = receita, y = ols_final_fitted,
color = "OLS Final"), size = 0.7) +
geom_point(aes(x = receita, y = hlm_final_fitted,
color = "Modelo HLM Final"), size = 0.7)  +
scale_color_manual("Modelos:",
values = c("deepskyblue2","darkorchid2"))+ #, "darkorchid2", "darkorchid2")) +
labs(x = "Receita real", y = "Fitted Values") +
theme_bw() +
theme(panel.grid = element_blank(),
axis.text.x = element_blank(),
axis.text.y = element_blank(),
axis.title.x = element_text(size = 11),
axis.title.y = element_text(size = 11),
legend.text = element_text(size = 11)))
#Plotagem
ggplotly(
vendas %>%
ggplot() +
geom_smooth(aes(x = receita, y = hlm_final_fitted, color = "Modelo HLM Final"),
method = "lm", se = F, formula = y ~ splines::bs(x, df = 5),
size = 1.5) +
geom_smooth(aes(x = receita, y= ols_final_fitted, color = "OLS Final"),
method = "lm", se = F, formula = y ~ splines::bs(x, df = 5),
size = 1.5) +
# normal
geom_smooth(aes(x = receita, y = receita), method = "lm",
color = "gray44", size = 1.05,
linetype = "longdash") +
geom_point(aes(x = receita, y = ols_final_fitted,
color = "OLS Final"), size = 0.7) +
geom_point(aes(x = receita, y = hlm_final_fitted,
color = "Modelo HLM Final"), size = 0.7)  +
scale_color_manual("Modelos:",
values = c("deepskyblue2","darkorchid2"))+ #, "darkorchid2", "darkorchid2")) +
labs(x = "Receita real", y = "Fitted Values") +
theme_bw() +
theme(panel.grid = element_blank(),
axis.text.x = element_blank(),
axis.text.y = element_blank(),
axis.title.x = element_text(size = 11),
axis.title.y = element_text(size = 11),
legend.text = element_text(size = 11)))
vendas %>%
ggplot() +
geom_smooth(aes(x = receita, y = hlm_final_fitted, color = "Modelo HLM Final"),
method = "lm", se = F, formula = y ~ splines::bs(x, df = 5),
size = 1.5) +
geom_smooth(aes(x = receita, y= ols_final_fitted, color = "OLS Final"),
method = "lm", se = F, formula = y ~ splines::bs(x, df = 5),
size = 1.5) +
# normal
geom_smooth(aes(x = receita, y = receita), method = "lm",
color = "gray44", size = 1.05,
linetype = "longdash") +
geom_point(aes(x = receita, y = ols_final_fitted,
color = "OLS Final"), size = 0.7) +
geom_point(aes(x = receita, y = hlm_final_fitted,
color = "Modelo HLM Final"), size = 0.7)  +
scale_color_manual("Modelos:",
values = c("deepskyblue2","darkorchid2"))+ #, "darkorchid2", "darkorchid2")) +
labs(x = "Receita real", y = "Fitted Values") +
theme_bw() +
theme(panel.grid = element_blank(),
axis.text.x = element_blank(),
axis.text.y = element_blank(),
axis.title.x = element_text(size = 11),
axis.title.y = element_text(size = 11),
legend.text = element_text(size = 11))
vendas %>%
ggplot() +
geom_smooth(aes(x = receita, y = hlm_final_fitted, color = "Modelo HLM Final"),
method = "lm", se = F, formula = y ~ splines::bs(x, df = 5),
size = 1.5) +
geom_smooth(aes(x = receita, y= ols_final_fitted, color = "OLS Final"),
method = "lm", se = F, formula = y ~ splines::bs(x, df = 5),
size = 1.5) +
# normal
geom_smooth(aes(x = receita, y = receita), method = "lm",
color = "gray44", size = 1.05,
linetype = "longdash") +
geom_point(aes(x = receita, y = ols_final_fitted,
color = "OLS Final"), size = 0.7) +
geom_point(aes(x = receita, y = hlm_final_fitted,
color = "Modelo HLM Final"), size = 0.7)  +
scale_color_manual("Modelos:",
values = c("deepskyblue2","darkorchid2"))+ #, "darkorchid2", "darkorchid2")) +
labs(x = "Receita real", y = "Fitted Values") +
theme_bw() +
theme(panel.grid = element_blank(),
axis.text.x = element_blank(),
axis.text.y = element_blank(),
axis.title.x = element_text(size = 12),
axis.title.y = element_text(size = 12),
legend.text = element_text(size = 12))
vendas %>%
ggplot() +
geom_smooth(aes(x = receita, y = hlm_final_fitted, color = "HLM"),
method = "lm", se = F, formula = y ~ splines::bs(x, df = 5),
size = 1.5) +
geom_smooth(aes(x = receita, y= ols_final_fitted, color = "OLS"),
method = "lm", se = F, formula = y ~ splines::bs(x, df = 5),
size = 1.5) +
# normal
geom_smooth(aes(x = receita, y = receita), method = "lm",
color = "gray44", size = 1.05,
linetype = "longdash") +
geom_point(aes(x = receita, y = hlm_final_fitted,
color = "HLM"), size = 0.7)  +
geom_point(aes(x = receita, y = ols_final_fitted,
color = "OLS"), size = 0.7) +
scale_color_manual("Modelos:",
values = c("deepskyblue2","darkorchid2"))+ #, "darkorchid2", "darkorchid2")) +
labs(x = "Receita real", y = "Fitted Values") +
theme_bw() +
theme(panel.grid = element_blank(),
axis.text.x = element_blank(),
axis.text.y = element_blank(),
axis.title.x = element_text(size = 12),
axis.title.y = element_text(size = 12),
legend.text = element_text(size = 12))
vendas %>%
ggplot() +
geom_smooth(aes(x = receita, y = hlm_final_fitted, color = "HLM"),
method = "lm", se = F, formula = y ~ splines::bs(x, df = 5),
size = 1.5) +
geom_smooth(aes(x = receita, y= ols_final_fitted, color = "OLS"),
method = "lm", se = F, formula = y ~ splines::bs(x, df = 5),
size = 1.5) +
# normal
geom_smooth(aes(x = receita, y = receita), method = "lm",
color = "gray44", size = 1.05,
linetype = "longdash") +
geom_point(aes(x = receita, y = hlm_final_fitted,
color = "HLM"), size = 0.7)  +
geom_point(aes(x = receita, y = ols_final_fitted,
color = "OLS"), size = 0.7) +
scale_color_manual("",
values = c("deepskyblue2","darkorchid2"))+ #, "darkorchid2", "darkorchid2")) +
labs(x = "Receita real", y = "Fitted Values") +
theme_bw() +
theme(panel.grid = element_blank(),
axis.text.x = element_blank(),
axis.text.y = element_blank(),
axis.title.x = element_text(size = 12),
axis.title.y = element_text(size = 12),
legend.text = element_text(size = 12))
source("01 - Pacotes.R")
# ---- Carregamento da base de dados ----
vendas =
fread("dados_vendas_totais_2021.csv", dec =",", sep=";") %>%
select(everything(), -cluster, -tempo_medio_contrato, -desemprego, perc_fidelidade) %>%
mutate(loja = as.factor(loja), cidade = as.factor(cidade))
#Comparando os LL dos modelos hlm Final, OLs e OLS com Dummies e Stepwise
data.frame(OLS_Dummies_Step = BIC(ols_final_dummies_step_wise),
hlm_Modelo_Final = BIC(hlm_final)) %>%
rename(`OLS com Dummies e Stepwise` = 1,
`HLM Modelo Final` = 2) %>%
reshape2::melt() %>%
ggplot(aes(x = variable, y = (abs(-value)), fill = factor(variable))) +
geom_bar(stat = "identity") +
geom_label(aes(label = (round(value,3))), hjust = 1.2, color = "white", size = 7) +
labs(title = "Comparação do BIC",
y = "BIC",
x = "Modelo Proposto") +
coord_flip() +
scale_fill_manual("Legenda:",
values = c("darkorchid","maroon1")) +
theme(legend.title = element_blank(),
panel.background = element_rect("white"),
legend.position = "none",
axis.line = element_line())
ggplotly(
vendas %>%
ggplot() +
geom_smooth(aes(x = receita, y = hlm_final_fitted, color = "HLM"),
method = "lm", se = F, formula = y ~ splines::bs(x, df = 5),
size = 1.5) +
geom_smooth(aes(x = receita, y= ols_final_fitted, color = "OLS"),
method = "lm", se = F, formula = y ~ splines::bs(x, df = 5),
size = 1.5) +
# normal
geom_smooth(aes(x = receita, y = receita), method = "lm",
color = "gray44", size = 1.05,
linetype = "longdash") +
geom_point(aes(x = receita, y = hlm_final_fitted,
color = "HLM"), size = 0.7)  +
geom_point(aes(x = receita, y = ols_final_fitted,
color = "OLS"), size = 0.7) +
scale_color_manual("",
values = c("deepskyblue2","darkorchid2"))+ #, "darkorchid2", "darkorchid2")) +
labs(x = "Receita real", y = "Fitted Values") +
theme_bw() +
theme(panel.grid = element_blank(),
axis.text.x = element_blank(),
axis.text.y = element_blank(),
axis.title.x = element_text(size = 12),
axis.title.y = element_text(size = 12),
legend.text = element_text(size = 12))
)
ggplotly(
vendas %>%
ggplot() +
geom_smooth(aes(x = receita, y = hlm_final_fitted, color = "HLM"),
method = "lm", se = F, formula = y ~ splines::bs(x, df = 5),
size = 1.5) +
geom_smooth(aes(x = receita, y= ols_final_fitted, color = "OLS"),
method = "lm", se = F, formula = y ~ splines::bs(x, df = 5),
size = 1.5) +
# normal
geom_smooth(aes(x = receita, y = receita), method = "lm",
color = "gray44", size = 0.5,
linetype = "longdash") +
geom_point(aes(x = receita, y = hlm_final_fitted,
color = "HLM"), size = 0.2)  +
geom_point(aes(x = receita, y = ols_final_fitted,
color = "OLS"), size = 0.2) +
scale_color_manual("",
values = c("deepskyblue2","darkorchid2"))+ #, "darkorchid2", "darkorchid2")) +
labs(x = "Receita real", y = "Fitted Values") +
theme_bw() +
theme(panel.grid = element_blank(),
axis.text.x = element_blank(),
axis.text.y = element_blank(),
axis.title.x = element_text(size = 12),
axis.title.y = element_text(size = 12),
legend.text = element_text(size = 12))
)
ggplotly(
vendas %>%
ggplot() +
geom_smooth(aes(x = receita, y = hlm_final_fitted, color = "HLM"),
method = "lm", se = F, formula = y ~ splines::bs(x, df = 5),
size = 1) +
geom_smooth(aes(x = receita, y= ols_final_fitted, color = "OLS"),
method = "lm", se = F, formula = y ~ splines::bs(x, df = 5),
size = 1) +
# normal
geom_smooth(aes(x = receita, y = receita), method = "lm",
color = "gray44", size = 0.5,
linetype = "longdash") +
geom_point(aes(x = receita, y = hlm_final_fitted,
color = "HLM"), size = 0.2)  +
geom_point(aes(x = receita, y = ols_final_fitted,
color = "OLS"), size = 0.2) +
scale_color_manual("",
values = c("deepskyblue2","darkorchid2"))+ #, "darkorchid2", "darkorchid2")) +
labs(x = "Receita real", y = "Fitted Values") +
theme_bw() +
theme(panel.grid = element_blank(),
axis.text.x = element_blank(),
axis.text.y = element_blank(),
axis.title.x = element_text(size = 12),
axis.title.y = element_text(size = 12),
legend.text = element_text(size = 12))
)
source("01 - Pacotes.R")
source("E:/OneDrive/Documentos/MBA Data Science and Analytics/00 - TCC/02 - HLM/02 - Geração Modelo.R", encoding = 'UTF-8', echo=TRUE)
